<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>使用 Electron 打造跨平台桌面应用 - UinIO.com 电子技术实验室</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="UinIO 电子技术实验室"><meta name="msapplication-TileImage" content="/images/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="UinIO 电子技术实验室"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="早期桌面应用的开发主要借助原生 C&amp;#x2F;C++ API 进行，由于需要反复经历编译过程，且无法分离界面 UI 与业务代码，开发调试极为不便。后期出现的 QT 和 WPF 在一定程度上解决了界面代码分离和跨平台的问题，却依然无法避免较长时间的编译过程。近几年伴随互联网行业的迅猛发展，尤其是 NodeJS、Chromium 这类基于 W3C 标准开源应用的不断涌现，原生代码与 Web 浏览器开发"><meta property="og:type" content="blog"><meta property="og:title" content="使用 Electron 打造跨平台桌面应用"><meta property="og:url" content="http://www.uinio.com/Web/Electron/"><meta property="og:site_name" content="UinIO.com 电子技术实验室"><meta property="og:description" content="早期桌面应用的开发主要借助原生 C&amp;#x2F;C++ API 进行，由于需要反复经历编译过程，且无法分离界面 UI 与业务代码，开发调试极为不便。后期出现的 QT 和 WPF 在一定程度上解决了界面代码分离和跨平台的问题，却依然无法避免较长时间的编译过程。近几年伴随互联网行业的迅猛发展，尤其是 NodeJS、Chromium 这类基于 W3C 标准开源应用的不断涌现，原生代码与 Web 浏览器开发"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://www.uinio.com/images/favicon.png"><meta property="article:published_time" content="2017-09-21T16:00:00.000Z"><meta property="article:modified_time" content="2018-01-13T16:00:00.000Z"><meta property="article:author" content="Hank"><meta property="article:tag" content="JavaScript"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://www.uinio.com/images/favicon.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.uinio.com/Web/Electron/"},"headline":"使用 Electron 打造跨平台桌面应用","image":["http://www.uinio.com/Web/Electron/logo.png"],"datePublished":"2017-09-21T16:00:00.000Z","dateModified":"2018-01-13T16:00:00.000Z","author":{"@type":"Person","name":"Hank"},"publisher":{"@type":"Organization","name":"UinIO.com 电子技术实验室","logo":{"@type":"ImageObject","url":{"text":"UinIO Lab"}}},"description":"早期桌面应用的开发主要借助原生 C&#x2F;C++ API\r 进行，由于需要反复经历编译过程，且无法分离界面 UI\r 与业务代码，开发调试极为不便。后期出现的 QT 和 WPF\r 在一定程度上解决了界面代码分离和跨平台的问题，却依然无法避免较长时间的编译过程。近几年伴随互联网行业的迅猛发展，尤其是\r NodeJS、Chromium 这类基于 W3C 标准开源应用的不断涌现，原生代码与 Web\r 浏览器开发"}</script><link rel="canonical" href="http://www.uinio.com/Web/Electron/"><link rel="alternate" href="/atom.xml" title="UinIO.com 电子技术实验室" type="application/atom+xml"><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://unpkg.com/highlight.js@11.7.0/styles/monokai.css"><link rel="stylesheet" href="https://fonts.font.im/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://unpkg.com/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://unpkg.com/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://unpkg.com/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">UinIO Lab</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" target="_blank" rel="noopener" href="https://space.bilibili.com/1514341594">Bilibili</a><a class="navbar-item" target="_blank" rel="noopener" href="https://www.zhihu.com/people/uinika">知乎</a><a class="navbar-item" target="_blank" rel="noopener" href="https://github.com/uinika">Github</a><a class="navbar-item" target="_blank" rel="noopener" href="https://gitee.com/uinika">Gitee</a><a class="navbar-item" href="/my/works.html">开源硬件</a><a class="navbar-item" href="/my/about.html">关于我</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-09-21T16:00:00.000Z" title="2017/9/22 00:00:00">2017-09-22</time>发表</span><span class="level-item"><time dateTime="2018-01-13T16:00:00.000Z" title="2018/1/14 00:00:00">2018-01-14</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Web-%E5%BC%80%E5%8F%91/">Web 开发</a></span><span class="level-item">1 小时读完 (大约8522个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">使用 Electron 打造跨平台桌面应用</h1><div class="content"><p>早期桌面应用的开发主要借助原生 C/C++ API
进行，由于需要反复经历编译过程，且无法分离界面 UI
与业务代码，开发调试极为不便。后期出现的 QT 和 WPF
在一定程度上解决了界面代码分离和跨平台的问题，却依然无法避免较长时间的编译过程。近几年伴随互联网行业的迅猛发展，尤其是
NodeJS、Chromium 这类基于 W3C 标准开源应用的不断涌现，原生代码与 Web
浏览器开发逐步走向融合，Electron 正是在这种背景下诞生的。</p>
<p><img src="/Web/Electron/logo.png"></p>
<p>Electron 是由 Github 开发，通过将<a href="www.chromium.org">Chromium</a>和<a target="_blank" rel="noopener" href="https://nodejs.org">NodeJS</a>整合为一个运行时环境，实现使用
HTML、CSS、JavaScript 构建跨平台的桌面应用程序的目的。Electron 源于 2013
年 Github 社区提供的开源编辑器 Atom，后于 2014 年在社区开源，并在 2016
年的 5 月和 8 月，通过了 <a target="_blank" rel="noopener" href="https://www.apple.com/mac/app-store/">Mac App Store</a> 和 <a target="_blank" rel="noopener" href="https://apps.microsoft.com/">Windows Store</a>
的上架许可，VSCode、Skype 等著名开源或商业应用程序，都是基于 Electron
打造。为了方便编写测试用例，笔者在 Github 搭建了一个简单的 Electron
种子项目<a target="_blank" rel="noopener" href="https://github.com/uinika/octopus">Octopus</a>，读者可以基于此来运行本文涉及的示例代码。</p>
<span id="more"></span>
<figure>
<img src="/Web/Electron/construction.png" alt="construction">
<figcaption aria-hidden="true">construction</figcaption>
</figure>
<h1 id="getting-start">Getting Start</h1>
<p>首先，让我们通过<code>npm init</code>和<code>git init</code>新建一个项目，然后通过如下<code>npm</code>语句安装最新的
Electron 稳定版。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜ npm i -D electron@latest</span><br></pre></td></tr></table></figure>
<p>然后向项目目录下的<code>package.json</code>文件添加一条<code>scripts</code>语句，便于后面通过<code>npm start</code>命令启动
Electron 应用。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// ... ...</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hank&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;resource/main.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;electron .&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;electron&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.7&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>然后在项目根目录下新建<code>resource</code>文件夹，里面分别再建立<code>index.html</code>和<code>main.js</code>两个文件，最终形成如下的项目结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">electron-demo</span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── package-lock.json</span><br><span class="line">├── README.md</span><br><span class="line">└── resource</span><br><span class="line">    ├── index.html</span><br><span class="line">    └── main.js</span><br></pre></td></tr></table></figure>
<p><code>main.js</code>是 Electron
应用程序的主入口点，当在命令行运行这段程序的时候，就会启动一个 Electron
的<strong>主进程</strong>，主进程当中可以通过代码打开指定的 Web
页面去展示 UI。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** main.js */</span></span><br><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mainWindow;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123; <span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">500</span> &#125;);</span><br><span class="line"></span><br><span class="line">  mainWindow.<span class="title function_">setMenu</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// mainWindow.loadFile(&quot;index.html&quot;); // 隐藏Chromium菜单</span></span><br><span class="line">  <span class="comment">// mainWindow.webContents.openDevTools() // 开启调试模式</span></span><br><span class="line"></span><br><span class="line">  mainWindow.<span class="title function_">on</span>(<span class="string">&quot;closed&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    mainWindow = <span class="literal">null</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;window-all-closed&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/* 在Mac系统用户通过Cmd+Q显式退出之前，保持应用程序和菜单栏处于激活状态。*/</span></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">platform</span> !== <span class="string">&quot;darwin&quot;</span>) &#123;</span><br><span class="line">    app.<span class="title function_">quit</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;activate&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/* 当dock图标被点击并且不会有其它窗口被打开的时候，在Mac系统上重新建立一个应用内的window。*/</span></span><br><span class="line">  <span class="keyword">if</span> (mainWindow === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="title function_">createWindow</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Web
页面<code>index.html</code>运行在自己的<strong>渲染进程</strong>当中，但是能够通过
NodeJS 提供的 API
去访问操作系统的原生资源（<em>例如下面代码中的<code>process.versions</code>语句</em>），这正是
Electron 能够跨平台执行的原因所在。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello Electron<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>你好，Electron！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 所有NodeJS可用的API都可以通过renderer.js的process属性访问 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">      当前Electron版本：</span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">write</span>(process.<span class="property">versions</span>.<span class="property">electron</span>);</span></span><br><span class="line"><span class="language-javascript">      </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">      当前NodeJS版本：</span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">write</span>(process.<span class="property">versions</span>.<span class="property">node</span>);</span></span><br><span class="line"><span class="language-javascript">      </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">      当前Chromium版本：</span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">write</span>(process.<span class="property">versions</span>.<span class="property">chrome</span>);</span></span><br><span class="line"><span class="language-javascript">      </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 这里也可以包含运行在当前进程里的其它文件</span></span></span><br><span class="line"><span class="language-javascript">      <span class="built_in">require</span>(<span class="string">&quot;./renderer.js&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用命令行工具执行<code>npm start</code>命令之后，上述 HTML
代码在笔者 Linux
操作系统内被渲染为如下界面。应用当中，可以通过<code>CTRL+R</code>重新加载页面，或者使用<code>CTRL+SHIFT+I</code>打开浏览器控制台。</p>
<figure>
<img src="/Web/Electron/hello-electron.png" alt="hello-electron">
<figcaption aria-hidden="true">hello-electron</figcaption>
</figure>
<blockquote>
<p>一个 Electron
应用的<strong>主进程</strong>只会有一个，<strong>渲染进程</strong>则会有多个。</p>
</blockquote>
<h1 id="主进程与渲染进程">主进程与渲染进程</h1>
<ul>
<li><strong>主进程</strong>（<em>main process</em>）管理所有的 web
页面以及相应的渲染进程，它通过<code>BrowserWindow</code>来创建视图页面。</li>
<li><strong>渲染进程</strong>（<em>renderer
processes</em>）用来运行页面，每个渲染进程都对应自己的<code>BrowserWindow</code>实例，如果实例被销毁那么渲染进程就会被终止。</li>
</ul>
<figure>
<img src="/Web/Electron/structure.png" alt="structure">
<figcaption aria-hidden="true">structure</figcaption>
</figure>
<p>Electron
分别在<strong>主进程</strong>和<strong>渲染进程</strong>提供了大量
API，可以通过<code>require</code>语句方便的将这些 API
包含在当前模块使用。但是 Electron 提供的 API
只能用于指定进程类型，即某些 API
只能用于渲染进程，而某些只能用于主进程，例如上面提到的<code>BrowserWindow</code>就只能用于主进程。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line">ccc = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>();</span><br></pre></td></tr></table></figure>
<p>Electron 通过<code>remote</code>模块暴露一些主进程的
API，如果需要在渲染进程中创建一个<code>BrowserWindow</code>实例，那么就可以借助这个
<code>remote</code> 模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; remote &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>); <span class="comment">// 获取remote模块</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span> &#125; = remote; <span class="comment">// 从remote当中获取BrowserWindow</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> browserWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(); <span class="comment">// 实例化获取的BrowserWindow</span></span><br></pre></td></tr></table></figure>
<p>Electron 可以使用所有 NodeJS 上提供的
API，同样只需要简单的<code>require</code>一下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = fs.<span class="title function_">readdirSync</span>(<span class="string">&quot;/&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>当然，NodeJS 上数以万计的 npm 包也同样在 Electron
可用，当然，如果是涉及到底层
C/C++的模块还需要单独进行编译，虽然这样的模块在 npm 仓库里并不多。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">S3</span> = <span class="built_in">require</span>(<span class="string">&quot;aws-sdk/clients/s3&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>既然 Electron
本质是一个<code>浏览器 + 跨平台中间件</code>的组合，因此常用的前端调试技术也适用于
Electron，这里可以通过<code>CTRL+SHIFT+I</code>手动开启 Chromium
的调试控制台，或者通过下面代码在开发模式下自动打开：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mainWindow.<span class="property">webContents</span>.<span class="title function_">openDevTools</span>(); <span class="comment">// 开启调试模式</span></span><br></pre></td></tr></table></figure>
<h1 id="核心模块">核心模块</h1>
<p>本节将对<code>require("electron")</code>所获取的模块进行概述，便于后期进行分类查找。</p>
<h2 id="app-模块">app 模块</h2>
<p>Electron
提供的<strong>app</strong>模块即提供了可用于区分开发和生产环境的<code>app.isPackaged</code>属性，也提供了关闭窗口的<code>app.quit()</code>和用于退出程序的<code>app.exit()</code>方法，以及<code>window-all-closed</code>和<code>ready</code>等
Electron 程序事件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;window-all-closed&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  app.<span class="title function_">quit</span>(); <span class="comment">// 当所有窗口关闭时退出应用程序</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以使用<code>app.getLocale()</code>获取当前操作系统的国际化信息。</p>
</blockquote>
<h2 id="browserwindow-模块">BrowserWindow 模块</h2>
<p>工作在主进程，用于创建和控制浏览器窗口。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主进程中使用如下方式获取。</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 渲染进程中可以使用remote属性获取。</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>).<span class="property">remote</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable language_">window</span> = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123; <span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">600</span> &#125;);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">on</span>(<span class="string">&quot;closed&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  win = <span class="literal">null</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载远程URL</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">loadURL</span>(<span class="string">&quot;https://uinika.github.io/&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载本地HTML</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">loadURL</span>(<span class="string">`file://<span class="subst">$&#123;__dirname&#125;</span>/app/index.html`</span>);</span><br></pre></td></tr></table></figure>
<p>例如需要创建一个无边框窗口的 Electron
应用程序，只需将<code>BrowserWindow</code>配置对象中的<code>frame</code>属性设置为<code>false</code>即可：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable language_">window</span> = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123; <span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">600</span>, <span class="attr">frame</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">show</span>();</span><br></pre></td></tr></table></figure>
<p>例如加载页面时，渲染进程第一次完成绘制时<code>BrowserWindow</code>会发出<code>ready-to-show</code>事件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> win = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123; <span class="attr">show</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">win.<span class="title function_">once</span>(<span class="string">&quot;ready-to-show&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  win.<span class="title function_">show</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>对于较为复杂的应用程序，<code>ready-to-show</code>事件的发出可能较晚，会让应用程序的打开显得缓慢。
这种情况下，建议通过<code>backgroundColor</code>属性设置接近应用程序背景色的方式显示窗口，从而获取更佳的用户体验。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable language_">window</span> = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123; <span class="attr">backgroundColor</span>: <span class="string">&quot;#272822&quot;</span> &#125;);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">loadURL</span>(<span class="string">&quot;https://uinika.github.io/&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>如果想要创建子窗口，那么可以使用<code>parent</code>选项，此时子窗口将总是显示在父窗口的顶部。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> top = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>();</span><br><span class="line"><span class="keyword">let</span> child = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123; <span class="attr">parent</span>: top &#125;);</span><br><span class="line"></span><br><span class="line">child.<span class="title function_">show</span>();</span><br><span class="line">top.<span class="title function_">show</span>();</span><br></pre></td></tr></table></figure>
<p>创建子窗口时，如果需要禁用父窗口，那么可以同时设置<code>modal</code>选项。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> child = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123; <span class="attr">parent</span>: top, <span class="attr">modal</span>: <span class="literal">true</span>, <span class="attr">show</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line">child.<span class="title function_">loadURL</span>(<span class="string">&quot;https://uinika.github.io/&quot;</span>);</span><br><span class="line">child.<span class="title function_">once</span>(<span class="string">&quot;ready-to-show&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  child.<span class="title function_">show</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="globalshortcut-模块">globalShortcut 模块</h2>
<p>使用<code>globalShortcut</code>模块中的<code>register()</code>方法注册快捷键。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, globalShortcut &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 注册一个快捷键监听器。</span></span><br><span class="line">  globalShortcut.<span class="title function_">register</span>(<span class="string">&quot;CommandOrControl+Y&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 当按下Control +Y键时触发该回调函数。</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Linux 和 Windows 上【Command】键会失效, 所以要使用
CommandOrControl（既 MacOS 上是【Command】键 ，Linux 和 Windows
上是【Control】键）。</p>
</blockquote>
<h2 id="clipboard-模块">clipboard 模块</h2>
<p>用于在系统剪贴板上执行复制和粘贴操作，包含有<code>readText()</code>、<code>writeText()</code>、<code>readHTML()</code>、<code>writeHTML()</code>、<code>readImage()</code>、<code>writeImage()</code>等方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; clipboard &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line">clipboard.<span class="title function_">writeText</span>(<span class="string">&quot;一些字符串内容&quot;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="globalshortcut-模块-1">globalShortcut 模块</h2>
<p>用于在 Electron
应用程序失去键盘焦点时监听全局键盘事件，即在操作系统中注册或注销全局快捷键。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, globalShortcut &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 注册全局快捷键</span></span><br><span class="line">  <span class="keyword">const</span> regist = globalShortcut.<span class="title function_">register</span>(<span class="string">&quot;CommandOrControl+A&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;快捷键被摁下！&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!regist) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;注册失败！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 检查快捷键是否注册成功</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(globalShortcut.<span class="title function_">isRegistered</span>(<span class="string">&quot;CommandOrControl+A&quot;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;will-quit&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 注销快捷键</span></span><br><span class="line">  globalShortcut.<span class="title function_">unregister</span>(<span class="string">&quot;CommandOrControl+A&quot;</span>);</span><br><span class="line">  <span class="comment">// 清空所有快捷键</span></span><br><span class="line">  globalShortcut.<span class="title function_">unregisterAll</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="ipcmain-与-ipcrenderer-模块">ipcMain 与 ipcRenderer 模块</h2>
<p>用于主进程到渲染进程的异步通信，下面是一个主进程与渲染进程之间发送和处理消息的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主进程</span></span><br><span class="line"><span class="keyword">const</span> &#123; ipcMain &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line">ipcMain.<span class="title function_">on</span>(<span class="string">&quot;asynchronous-message&quot;</span>, <span class="function">(<span class="params">event, arg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(arg); <span class="comment">// 打印 &quot;ping&quot;</span></span><br><span class="line">  event.<span class="property">sender</span>.<span class="title function_">send</span>(<span class="string">&quot;asynchronous-reply&quot;</span>, <span class="string">&quot;pong&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ipcMain.<span class="title function_">on</span>(<span class="string">&quot;synchronous-message&quot;</span>, <span class="function">(<span class="params">event, arg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(arg); <span class="comment">// 打印 &quot;ping&quot;</span></span><br><span class="line">  event.<span class="property">returnValue</span> = <span class="string">&quot;pong&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//渲染器进程，即网页</span></span><br><span class="line"><span class="keyword">const</span> &#123; ipcRenderer &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ipcRenderer.<span class="title function_">sendSync</span>(<span class="string">&quot;synchronous-message&quot;</span>, <span class="string">&quot;ping&quot;</span>)); <span class="comment">// 打印 &quot;pong&quot;</span></span><br><span class="line"></span><br><span class="line">ipcRenderer.<span class="title function_">on</span>(<span class="string">&quot;asynchronous-reply&quot;</span>, <span class="function">(<span class="params">event, arg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(arg); <span class="comment">// 打印 &quot;pong&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line">ipcRenderer.<span class="title function_">send</span>(<span class="string">&quot;asynchronous-message&quot;</span>, <span class="string">&quot;ping&quot;</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果需要完成渲染器进程到主进程的异步通信，可以选择使用<code>ipcRenderer</code>对象。</p>
</blockquote>
<h2 id="menu-与-menuitem-模块">Menu 与 MenuItem 模块</h2>
<p>用于主进程，用于创建原生应用菜单和上下文菜单。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span>, <span class="title class_">Menu</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mainWindow;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&quot;自定义菜单&quot;</span>,</span><br><span class="line">    <span class="attr">submenu</span>: [&#123; <span class="attr">label</span>: <span class="string">&quot;菜单项-1&quot;</span> &#125;, &#123; <span class="attr">label</span>: <span class="string">&quot;菜单项-2&quot;</span> &#125;],</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123; <span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">500</span> &#125;);</span><br><span class="line">  mainWindow.<span class="title function_">setMenu</span>(<span class="title class_">Menu</span>.<span class="title function_">buildFromTemplate</span>(template));</span><br><span class="line">  mainWindow.<span class="title function_">loadFile</span>(<span class="string">&quot;resource/index.html&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用<code>MenuItem</code>类可以添加菜单项至 Electron
应用程序菜单和上下文菜单当中。</p>
</blockquote>
<figure>
<img src="/Web/Electron/menu.png" alt="menu">
<figcaption aria-hidden="true">menu</figcaption>
</figure>
<h2 id="netlog-模块">netLog 模块</h2>
<p>用于记录网络日志。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; netLog &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line">netLog.<span class="title function_">startLogging</span>(<span class="string">&quot;/user/log.info&quot;</span>);</span><br><span class="line"><span class="comment">/** 一些网络事件发生之后 */</span></span><br><span class="line">netLog.<span class="title function_">stopLogging</span>(<span class="function">(<span class="params">path</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;网络日志log.info保存在&quot;</span>, path);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="powermonitor-模块">powerMonitor 模块</h2>
<p>通过 Electron
提供的<code>powerMonitor</code>模块监视当前电脑电源状态的改变，值得注意的是，在<code>app</code>模块的<code>ready</code>事件被触发之前,
不能引用或使用该模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> electron = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; app &#125; = electron;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  electron.<span class="property">powerMonitor</span>.<span class="title function_">on</span>(<span class="string">&quot;suspend&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;系统将要休眠了！&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="powersaveblocker-模块">powerSaveBlocker 模块</h2>
<p>阻止操作系统进入低功耗 (休眠) 模式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; powerSaveBlocker &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ID</span> = powerSaveBlocker.<span class="title function_">start</span>(<span class="string">&quot;prevent-display-sleep&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(powerSaveBlocker.<span class="title function_">isStarted</span>(<span class="variable constant_">ID</span>));</span><br><span class="line"></span><br><span class="line">powerSaveBlocker.<span class="title function_">stop</span>(<span class="variable constant_">ID</span>);</span><br></pre></td></tr></table></figure>
<h2 id="protocol-模块">protocol 模块</h2>
<p>注册自定义协议并拦截基于现有协议的请求，例如下面代码实现了一个与<code>[file://]</code>协议等效的示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, protocol &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  protocol.<span class="title function_">registerFileProtocol</span>(</span><br><span class="line">    <span class="string">&quot;uinika&quot;</span>,</span><br><span class="line">    <span class="function">(<span class="params">request, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> url = request.<span class="property">url</span>.<span class="title function_">substr</span>(<span class="number">7</span>);</span><br><span class="line">      <span class="title function_">callback</span>(&#123; <span class="attr">path</span>: path.<span class="title function_">normalize</span>(<span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/<span class="subst">$&#123;url&#125;</span>`</span>) &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;协议注册失败！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="net-模块">net 模块</h2>
<p><code>net</code>模块是一个发送 HTTP(S) 请求的客户端 API，类似于
NodeJS 的 HTTP 和 HTTPS 模块 ，但底层使用的是 Chromium 原生网络库。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; net &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> request = net.<span class="title function_">request</span>(<span class="string">&quot;https://zhihu.com/people/uinika/activities&quot;</span>);</span><br><span class="line"></span><br><span class="line">  request.<span class="title function_">on</span>(<span class="string">&quot;response&quot;</span>, <span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`STATUS: <span class="subst">$&#123;response.statusCode&#125;</span>`</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`HEADERS: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(response.headers)&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    response.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`BODY: <span class="subst">$&#123;chunk&#125;</span>`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    response.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;没有更多数据！&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  request.<span class="title function_">end</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Electron 中提供的<code>ClientRequest</code>类用来发起 HTTP/HTTPS
请求，<code>IncomingMessage</code>类则用于响应 HTTP/HTTPS 请求。</p>
</blockquote>
<h2 id="remote-模块">remote 模块</h2>
<p><code>remote</code>模块返回的每个对象都表示主进程中的一个对象，调用这个对象实质是在发送同步进程消息。因为
Electron 当中 GUI 相关的模块 (如 <code>dialog</code>、<code>menu</code>
等) 仅在主进程中可用,
在渲染进程中不可用，所以<code>remote</code>模块提供了一种渲染进程（<em>Web
页面</em>）与主进程（<em>IPC</em>）通信的简单方法。remote
模块包含了一个<code>remote.require(module)</code></p>
<ul>
<li><code>remote.process</code>：主进程中的<code>process</code>对象，与<code>remote.getGlobal("process")</code>作用相同,
但结果已经被缓存。</li>
<li><code>remote.getCurrentWindow()</code>：返回<code>BrowserWindow</code>，即该网页所属的窗口。</li>
<li><code>remote.getCurrentWebContents()</code>：返回<code>WebContents</code>，即该网页的
Web 内容</li>
<li><code>remote.getGlobal(name)</code>：该方法返回主进程中名为<code>name</code>的全局变量。</li>
<li><code>remote.require(module)</code>：返回主进程内执行<code>require(module)</code>时返回的对象，参数<code>module</code>指定的模块相对路径将会相对于主进程入口点进行解析。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">project/</span><br><span class="line">├── main</span><br><span class="line">│   ├── helper.js</span><br><span class="line">│   └── index.js</span><br><span class="line">├── package.json</span><br><span class="line">└── renderer</span><br><span class="line">    └── index.js</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主进程: main/index.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; app &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主进程关联的模块: main/test.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="string">&quot;This is a test!&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 渲染进程: renderer/index.js</span></span><br><span class="line"><span class="keyword">const</span> helper = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>).<span class="property">remote</span>.<span class="built_in">require</span>(<span class="string">&quot;./helper&quot;</span>); <span class="comment">// This is a test!</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>remote</code>模块提供的主进程与渲染进程通信方法比<code>ipcMain</code>/<code>ipcRenderer</code>更加易于使用。</p>
</blockquote>
<h2 id="screen-模块">screen 模块</h2>
<p>检索有关屏幕大小、显示器、光标位置等信息，应用的<code>ready</code>事件触发之前，不能使用该模块。下面的示例代码，创建了一个可以自动全屏窗口的应用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> electron = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span> &#125; = electron;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable language_">window</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; width, height &#125; = electron.<span class="property">screen</span>.<span class="title function_">getPrimaryDisplay</span>().<span class="property">workAreaSize</span>;</span><br><span class="line">  <span class="variable language_">window</span> = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123; width, height &#125;);</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">loadURL</span>(<span class="string">&quot;https://github.com&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="shell-模块">shell 模块</h2>
<p>提供与桌面集成相关的功能，例如可以通过调用操作系统默认的应用程序管理文件或<code>Url</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; shell &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line">shell.<span class="title function_">openExternal</span>(<span class="string">&quot;https://github.com&quot;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="systempreferences-模块">systemPreferences 模块</h2>
<p>获取操作系统特定的偏好信息，例如在 Mac
下可以通过下面代码获取当前是否开启系统 Dark 模式的信息。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; systemPreferences &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(systemPreferences.<span class="title function_">isDarkMode</span>()); <span class="comment">// 返回一个布尔值。</span></span><br></pre></td></tr></table></figure>
<h2 id="tray-模块">Tray 模块</h2>
<p>用于主进程，添加图标和上下文菜单至操作系统通知区域。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">Menu</span>, <span class="title class_">Tray</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> tray = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  tray = <span class="keyword">new</span> <span class="title class_">Tray</span>(<span class="string">&quot;/images/icon&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> contextMenu = <span class="title class_">Menu</span>.<span class="title function_">buildFromTemplate</span>([</span><br><span class="line">    &#123; <span class="attr">label</span>: <span class="string">&quot;Item1&quot;</span>, <span class="attr">type</span>: <span class="string">&quot;radio&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">label</span>: <span class="string">&quot;Item2&quot;</span>, <span class="attr">type</span>: <span class="string">&quot;radio&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">label</span>: <span class="string">&quot;Item3&quot;</span>, <span class="attr">type</span>: <span class="string">&quot;radio&quot;</span>, <span class="attr">checked</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">label</span>: <span class="string">&quot;Item4&quot;</span>, <span class="attr">type</span>: <span class="string">&quot;radio&quot;</span> &#125;,</span><br><span class="line">  ]);</span><br><span class="line">  tray.<span class="title function_">setToolTip</span>(<span class="string">&quot;This is my application.&quot;</span>);</span><br><span class="line">  tray.<span class="title function_">setContextMenu</span>(contextMenu);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="webframe-模块">webFrame 模块</h2>
<p>定义当前网页渲染的一些属性，比如缩放比例、缩放等级、设置拼写检查、执行
JavaScript 脚本等等。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; webFrame &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line">webFrame.<span class="title function_">setZoomFactor</span>(<span class="number">5</span>); <span class="comment">// 将页面缩放至500%。</span></span><br></pre></td></tr></table></figure>
<h2 id="session-模块">session 模块</h2>
<p>Electron
的<code>session</code>模块可以创建新的<code>session</code>对象，主要用来管理浏览器会话、cookie、缓存、代理设置等等。</p>
<p>如果需要访问现有页面的<code>session</code>，那么可以通过<code>BrowserWindow</code>对象的<code>webContents</code>的<code>session</code>属性来获取。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable language_">window</span> = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123; <span class="attr">width</span>: <span class="number">600</span>, <span class="attr">height</span>: <span class="number">900</span> &#125;);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">loadURL</span>(<span class="string">&quot;https://uinika.github.io/web/server/electron.html&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mySession = <span class="variable language_">window</span>.<span class="property">webContents</span>.<span class="property">session</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mySession.<span class="title function_">getUserAgent</span>());</span><br></pre></td></tr></table></figure>
<p>Electron
里也可以通过<code>session</code>模块的<code>cookies</code>属性来访问浏览器的
Cookie 实例。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; session &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询所有cookies。</span></span><br><span class="line">session.<span class="property">defaultSession</span>.<span class="property">cookies</span>.<span class="title function_">get</span>(&#123;&#125;, <span class="function">(<span class="params">error, cookies</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(error, cookies);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询当前URL下的所有cookies。</span></span><br><span class="line">session.<span class="property">defaultSession</span>.<span class="property">cookies</span>.<span class="title function_">get</span>(</span><br><span class="line">  &#123; <span class="attr">url</span>: <span class="string">&quot;http://www.github.com&quot;</span> &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error, cookies</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error, cookies);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置cookie</span></span><br><span class="line"><span class="keyword">const</span> cookie = &#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;https://www.zhihu.com/people/uinika/posts&quot;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;hank&quot;</span>,</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&quot;zhihu&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line">session.<span class="property">defaultSession</span>.<span class="property">cookies</span>.<span class="title function_">set</span>(cookie, <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>使用<code>Session</code>的<code>WebRequest</code>属性可以访问<code>WebRequest</code>类的实例，<code>WebRequest</code>类可以在
HTTP 请求生命周期的不同阶段修改相关内容，例如下面代码为 HTTP
请求添加了一个<code>User-Agent</code>协议头：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; session &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送至下面URL地址的请求将会被添加User-Agent协议头</span></span><br><span class="line"><span class="keyword">const</span> filter = &#123;</span><br><span class="line">  <span class="attr">urls</span>: [<span class="string">&quot;https://*.github.com/*&quot;</span>, <span class="string">&quot;*://electron.github.io&quot;</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">session.<span class="property">defaultSession</span>.<span class="property">webRequest</span>.<span class="title function_">onBeforeSendHeaders</span>(</span><br><span class="line">  filter,</span><br><span class="line">  <span class="function">(<span class="params">details, callback</span>) =&gt;</span> &#123;</span><br><span class="line">    details.<span class="property">requestHeaders</span>[<span class="string">&quot;User-Agent&quot;</span>] = <span class="string">&quot;MyAgent&quot;</span>;</span><br><span class="line">    <span class="title function_">callback</span>(&#123; <span class="attr">cancel</span>: <span class="literal">false</span>, <span class="attr">requestHeaders</span>: details.<span class="property">requestHeaders</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="desktopcapturer-模块">desktopCapturer 模块</h2>
<p>用于捕获桌面窗口里的内容，该模块只拥有一个方法：<code>desktopCapturer.getSources(options, callback)</code>。</p>
<ol type="1">
<li><code>options</code> 对象
<ul>
<li><code>types</code>：字符串数组，列出需要捕获的桌面类型是<code>screen</code>还是<code>window</code>。</li>
<li><code>thumbnailSize</code>：媒体源缩略图的大小，默认为<code>150x150</code>。</li>
</ul></li>
<li><code>callback</code> 回调函数，拥有如下 2 个参数：
<ul>
<li><code>error</code>：错误信息。</li>
<li><code>sources</code>：捕获的资源数组。</li>
</ul></li>
</ol>
<p>如下代码工作在渲染进程当中，作用是将桌面窗口捕获为视频：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; desktopCapturer &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line">desktopCapturer.<span class="title function_">getSources</span>(</span><br><span class="line">  &#123; <span class="attr">types</span>: [<span class="string">&quot;window&quot;</span>, <span class="string">&quot;screen&quot;</span>] &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error, sources</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; sources.<span class="property">length</span>; ++i) &#123;</span><br><span class="line">      <span class="keyword">if</span> (sources[i].<span class="property">name</span> === <span class="string">&quot;Electron&quot;</span>) &#123;</span><br><span class="line">        navigator.<span class="property">mediaDevices</span></span><br><span class="line">          .<span class="title function_">getUserMedia</span>(&#123;</span><br><span class="line">            <span class="attr">audio</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">video</span>: &#123;</span><br><span class="line">              <span class="attr">mandatory</span>: &#123;</span><br><span class="line">                <span class="attr">chromeMediaSource</span>: <span class="string">&quot;desktop&quot;</span>,</span><br><span class="line">                <span class="attr">chromeMediaSourceId</span>: sources[i].<span class="property">id</span>,</span><br><span class="line">                <span class="attr">minWidth</span>: <span class="number">1280</span>,</span><br><span class="line">                <span class="attr">maxWidth</span>: <span class="number">1280</span>,</span><br><span class="line">                <span class="attr">minHeight</span>: <span class="number">800</span>,</span><br><span class="line">                <span class="attr">maxHeight</span>: <span class="number">800</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">then</span>(<span class="function">(<span class="params">stream</span>) =&gt;</span> <span class="title function_">handleStream</span>(stream))</span><br><span class="line">          .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> <span class="title function_">handleError</span>(error));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleStream</span>(<span class="params">stream</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> video = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;video&quot;</span>);</span><br><span class="line">  video.<span class="property">srcObject</span> = stream;</span><br><span class="line">  video.<span class="property">onloadedmetadata</span> = <span class="function">(<span class="params">error</span>) =&gt;</span> video.<span class="title function_">play</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params">error</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="dialog-模块">dialog 模块</h2>
<p>调用操作系统原生的对话框，工作在主线程，下面示例展示了一个用于选择多个文件和目录的对话框：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; dialog &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">  dialog.<span class="title function_">showOpenDialog</span>(&#123;</span><br><span class="line">    <span class="attr">properties</span>: [<span class="string">&quot;openFile&quot;</span>, <span class="string">&quot;openDirectory&quot;</span>, <span class="string">&quot;multiSelections&quot;</span>],</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>由于对话框工作在 Electron 的主线程上，如果需要在渲染器进程中使用,
那么可以通过<code>remote</code>来获得：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; dialog &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>).<span class="property">remote</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dialog);</span><br></pre></td></tr></table></figure>
<h2 id="contenttracing-模块">contentTracing 模块</h2>
<p>从 Chromium
收集跟踪数据，从而查找性能瓶颈。使用后需要在浏览器打开<code>chrome://tracing/</code>页面，然后加载生成的文件查看结果。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, contentTracing &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> options = &#123;</span><br><span class="line">    <span class="attr">categoryFilter</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">    <span class="attr">traceOptions</span>: <span class="string">&quot;record-until-full,enable-sampling&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  contentTracing.<span class="title function_">startRecording</span>(options, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;开始跟踪!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      contentTracing.<span class="title function_">stopRecording</span>(<span class="string">&quot;&quot;</span>, <span class="function">(<span class="params">path</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;跟踪数据已经记录至&quot;</span> + path);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, <span class="number">8000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="webview-标签">webview 标签</h1>
<p>Electron 的<code>&lt;webview&gt;</code>标签基于
Chromium，由于开发变动较大官方并不建议使用，而应考虑<code>&lt;iframe&gt;</code>或者
Electron
的<code>BrowserView</code>等选择，或者完全避免在页面进行内容嵌入。</p>
<p><code>&lt;webview&gt;</code>与<code>&lt;iframe&gt;</code>最大不同是运行于不同的进程当中，Electron
应用程序与嵌入内容之间的所有交互都是异步进行的，这样可以保证应用程序与嵌入内容双方的安全。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">webview</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;uinika&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;http://localhost:5000/web/server/electron.html&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">webview</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="webcontents-属性">webContents 属性</h1>
<p><code>webContents</code>是<code>BrowserWindow</code>对象的一个属性，负责渲染和控制
Web 页面。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable language_">window</span> = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123; <span class="attr">width</span>: <span class="number">600</span>, <span class="attr">height</span>: <span class="number">500</span> &#125;);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">loadURL</span>(<span class="string">&quot;https://uinika.github.io/&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> contents = <span class="variable language_">window</span>.<span class="property">webContents</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(contents);</span><br></pre></td></tr></table></figure>
<h1 id="window.open-函数">window.open() 函数</h1>
<p>该函数用于打开一个新窗口并加载指定<code>url</code>，调用后将会为该<code>url</code>创建一个<code>BrowserWindow</code>实例，并返回一个<code>BrowserWindowProxy</code>对象，但是该对象只能对打开的<code>url</code>页面进行有限的控制。正常情况下，如果希望完全控制新窗口，可以直接创建一个新的<code>BrowserWindow</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// window.open(url[, frameName][, features])</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&quot;https://github.com&quot;</span>, <span class="string">&quot;_blank&quot;</span>, <span class="string">&quot;nodeIntegration=no&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><code>BrowserWindowProxy</code>对象拥有如下属性和方法：</p>
<ul>
<li><code>win.closed</code>：子窗口关闭后设置为<code>true</code>的布尔属性。</li>
<li><code>win.blur()</code>：将焦点从子窗口中移除。</li>
<li><code>win.close()</code>：强制关闭子窗口, 而不调用其卸载事件。</li>
<li><code>win.eval(code)</code>：<code>code</code>字符串，需要在子窗口
Eval 的代码。</li>
<li><code>win.focus()</code>：聚焦子窗口（<em>即将子窗口置顶</em>）。</li>
<li><code>win.print()</code>：调用子窗口的打印对话框。</li>
<li><code>win.postMessage(message, targetOrigin)</code>：向子窗口发送信息。</li>
</ul>
<h1 id="electron-进程">Electron 进程</h1>
<p>Electron 的<code>process</code>对象继承自 NodeJS
的<code>process</code>对象，但是新增了一些有用的事件、属性、方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mainWindow;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123; <span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">500</span>, <span class="attr">frame</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">  mainWindow.<span class="title function_">loadFile</span>(<span class="string">&quot;resource/index.html&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(process.<span class="property">type</span>); <span class="comment">// 当前进程类型是browser主进程还是renderer渲染进程，browser</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(process.<span class="property">versions</span>.<span class="property">node</span>); <span class="comment">// NodeJS版本，10.2.0</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(process.<span class="property">versions</span>.<span class="property">chrome</span>); <span class="comment">// Chrome版本，66.0.3359.181</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(process.<span class="property">versions</span>.<span class="property">electron</span>); <span class="comment">//Electron版本，3.0.13</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(process.<span class="property">resourcesPath</span>); <span class="comment">// 资源目录路径，D:\Workspace\octopus\node_modules\electron\dist\resources</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="沙箱机制">沙箱机制</h1>
<p>Chromium 通过将 Web
前端代码放置在一个与操作系统隔离的沙箱中运行，从而保证恶意代码不会侵犯到操作系统本身。但是
Electron 中渲染进程可以调用 NodeJS，而 NodeJS
又需要涉及大量操作系统调用，因而沙箱机制默认是禁用的。</p>
<p>某些应用场景下，需要运行一些不确定安全性的外部前端代码，为了保证操作系统安全，可能需要开启沙箱机制。此时首先在创建<code>BrowserWindow</code>时传入<code>sandbox</code>属性，然后在命令行添加<code>--enable-sandbox</code>参数传递给
Electron 即可完成开启。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> win;</span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">window</span> = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">      <span class="attr">sandbox</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">loadURL</span>(<span class="string">&quot;http://google.com&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用<code>sandbox</code>选项之后，将会阻止 Electron
在渲染器中创建一个 NodeJS
运行时环境，此时新窗口中的<code>window.open()</code>
将按照浏览器原生的方式工作。</p>
</blockquote>
<h1 id="macbook-touchbar-支持">MacBook TouchBar 支持</h1>
<p>针对 Mac 笔记本电脑上配置的 TouchBar 硬件，Electron
提供了一系列相关的类与操作接口：<code>TouchBar</code>、<code>TouchBarButton</code>、<code>TouchBarColorPicker</code>、<code>TouchBarGroup</code>、<code>TouchBarLabel</code>、<code>TouchBarPopover</code>、<code>TouchBarScrubber</code>、<code>TouchBarSegmentedControl</code>、<code>TouchBarSlider</code>、<code>TouchBarSpacer</code>。</p>
<h1 id="创建应用图标">创建应用图标</h1>
<p>用于将 PNG 或 JPG 图片设置为托盘、Dock 和应用程序的图标。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span>, <span class="title class_">Tray</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Icon</span> = <span class="keyword">new</span> <span class="title class_">Tray</span>(<span class="string">&quot;/images/icon.png&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable language_">window</span> = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123; <span class="attr">icon</span>: <span class="string">&quot;/images/window.png&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>
<h1 id="安全原则">安全原则</h1>
<p>由于 Electron 的发布通常落后最新版本 Chromium
几周甚至几个月，因此特别需要注意如下这些安全性问题：</p>
<h2 id="使用安全的协议加载外部内容">使用安全的协议加载外部内容</h2>
<p>外部资源尽量使用更安全的协议加载，比如<code>HTTP</code>换成<code>HTTPS</code>、<code>WS</code>换成<code>WSS</code>、<code>FTP</code>换成<code>FTPS</code>等。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 错误 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">crossorigin</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.com/react.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://cdn.com/scss.css&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 正确 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">crossorigin</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.com/react.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.com/scss.css&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  browserWindow.loadURL(&quot;http://uinika.github.io/); // 错误</span><br><span class="line">  browserWindow.loadURL(&quot;https://uinika.github.io/&quot;); // 正确</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="加载外部内容时禁用-nodejs-集成">加载外部内容时禁用 NodeJS
集成</h2>
<p>使用<code>BrowserWindow</code>、<code>BrowserView</code>、<code>&lt;webview&gt;</code>加载远程内容时，都需要通过禁用
NodeJS 集成去限制远程代码的执行权限，避免恶意代码跨站攻击。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 错误 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">webview</span> <span class="attr">nodeIntegration</span> <span class="attr">src</span>=<span class="string">&quot;page.html&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">webview</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 正确 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">webview</span> <span class="attr">src</span>=<span class="string">&quot;page.html&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">webview</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">/** 错误 */</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>();</span></span><br><span class="line"><span class="language-javascript">  mainWindow.<span class="title function_">loadURL</span>(<span class="string">&quot;https://my-website.com&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">/** 正确 */</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">webPreferences</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">nodeIntegration</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">preload</span>: <span class="string">&quot;./preload.js&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>对于需要与远程代码共享的变量或函数，可以通过将其挂载至当前页面的<code>window</code>全局对象来实现。</p>
</blockquote>
<h2 id="渲染进程中启用上下文隔离">渲染进程中启用上下文隔离</h2>
<p>上下文隔离是 Electron
提供的试验特性，通过为远程加载的代码创造一个全新上下文环境，避免与主进程中的代码出现冲突或者相互污染。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主进程</span></span><br><span class="line"><span class="keyword">const</span> mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">  <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">    <span class="attr">contextIsolation</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">preload</span>: <span class="string">&quot;preload.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="处理远程内容中的会话许可">处理远程内容中的会话许可</h2>
<p>当页面尝试使用某个特性时，会弹出通知让用户手动进行确认；而默认情况下，Electron
会自动批准所有的许可请求。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; session &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line">session</span><br><span class="line">  .<span class="title function_">fromPartition</span>(<span class="string">&quot;some-partition&quot;</span>)</span><br><span class="line">  .<span class="title function_">setPermissionRequestHandler</span>(<span class="function">(<span class="params">webContents, permission, callback</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> url = webContents.<span class="title function_">getURL</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (permission === <span class="string">&quot;notifications&quot;</span>) &#123;</span><br><span class="line">      <span class="title function_">callback</span>(<span class="literal">true</span>); <span class="comment">// 通过许可请求</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!url.<span class="title function_">startsWith</span>(<span class="string">&quot;https://my-website.com&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="literal">false</span>); <span class="comment">// 拒绝许可请求</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="不要禁用-websecurity">不要禁用 webSecurity</h2>
<p>在渲染进程禁用<code>webSecurity</code>将导致许多重要的安全性功能被关闭，因此
Electron 默认开启。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">  <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">    <span class="attr">webSecurity</span>: <span class="literal">false</span>, <span class="comment">// 错误的做法，缺省该属性使用默认值即可。</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="定义-csp-安全策略">定义 CSP 安全策略</h2>
<p>内容安全策略 CSP 允许 Electron 通过<code>webRequest</code>对指定 URL
的访问进行约束，例如允许加载<code>https://uinika.github.io/</code>这个源，那么<code>https://hack.attacker.com</code>将不会被允许加载，CSP
是处理跨站脚本攻击、数据注入攻击的另外一层保护措施。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; session &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line">session.<span class="property">defaultSession</span>.<span class="property">webRequest</span>.<span class="title function_">onHeadersReceived</span>(<span class="function">(<span class="params">details, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">callback</span>(&#123;</span><br><span class="line">    <span class="attr">responseHeaders</span>: &#123;</span><br><span class="line">      ...details.<span class="property">responseHeaders</span>,</span><br><span class="line">      <span class="string">&quot;Content-Security-Policy&quot;</span>: [<span class="string">&quot;default-src &#x27;none&#x27;&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>使用<code>file://</code>协议打开本地文件时，可以通过元数据标签<code>&lt;meta&gt;</code>的属性来添加
CSP 约束。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;default-src &#x27;none&#x27;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="别设置-allowrunninginsecurecontent-为-true">别设置
allowRunningInsecureContent 为 true</h2>
<p>Electron 默认不允许在 HTTPS 页面中加载 HTTP
来源的代码，如果将<code>allowRunningInsecureContent</code>属性设置为<code>true</code>会禁用这种保护。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">  <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">    <span class="attr">allowRunningInsecureContent</span>: <span class="literal">true</span>, <span class="comment">// 错误的做法，缺省该属性使用默认值即可。</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="不要开启实验性功能">不要开启实验性功能</h2>
<p>开发人员可以通过<code>experimentalFeatures</code>属性启用未经严格测试的
Chromium 实验性功能，不过 Electron
官方出于稳定性和安全性考虑并不建议这样做。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">  <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">    <span class="attr">experimentalFeatures</span>: <span class="literal">true</span>, <span class="comment">// 错误的做法，缺省该属性使用默认值即可。</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="不要使用-enableblinkfeatures">不要使用 enableBlinkFeatures</h2>
<p>Blink 是 Chromium 内置的 HTML/CSS
渲染引擎，开发者可以通过<code>enableBlinkFeatures</code>启用其某些默认是禁用的特性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">  <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">    <span class="attr">enableBlinkFeatures</span>: [<span class="string">&quot;ExecCommandInJavaScript&quot;</span>], <span class="comment">// 错误的做法，缺省该属性使用默认值即可。</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="禁用-webview-的-allowpopups">禁用 webview 的 allowpopups</h2>
<p>开启<code>allowpopups</code>属性将使<code>window.open()</code>创建一个新的窗口和<code>BrowserWindows</code>，若非必要状况，尽量不要使用此属性。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 错误 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">webview</span> <span class="attr">allowpopups</span> <span class="attr">src</span>=<span class="string">&quot;page.html&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">webview</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 正确 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">webview</span> <span class="attr">src</span>=<span class="string">&quot;page.html&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">webview</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="验证-webview-选项与参数">验证 webview 选项与参数</h2>
<p>通过渲染进程创建的<code>&lt;WebView&gt;</code>默认不集成
NodeJS，但是它可以通过<code>webPreferences</code>属性创建出一个独立的渲染进程。在<code>&lt;WebView&gt;</code>标签开始渲染之前，Electron
将会触发一个<code>will-attach-webview</code>事件，可以通过该事件防止创建具有潜在不安全选项的
Web 视图。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;web-contents-created&quot;</span>, <span class="function">(<span class="params">event, contents</span>) =&gt;</span> &#123;</span><br><span class="line">  contents.<span class="title function_">on</span>(<span class="string">&quot;will-attach-webview&quot;</span>, <span class="function">(<span class="params">event, webPreferences, params</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 如果未使用或者验证位置合法，那么将会剥离预加载脚本。</span></span><br><span class="line">    <span class="keyword">delete</span> webPreferences.<span class="property">preload</span>;</span><br><span class="line">    <span class="keyword">delete</span> webPreferences.<span class="property">preloadURL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 禁用NodeJS集成。</span></span><br><span class="line">    webPreferences.<span class="property">nodeIntegration</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证正在加载的URL。</span></span><br><span class="line">    <span class="keyword">if</span> (!params.<span class="property">src</span>.<span class="title function_">startsWith</span>(<span class="string">&quot;https://www.zhihu.com/people/uinika/columns&quot;</span>)) &#123;</span><br><span class="line">      event.<span class="title function_">preventDefault</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="禁用或限制网页跳转">禁用或限制网页跳转</h2>
<p>如果 Electron
应用程序不需要导航或只需导航至特定页面，最佳实践是将导航限制在已知范围，并禁止其它类型的导航。可以通过在<code>will- navigation</code>事件处理函数中调用<code>event.preventDefault()</code>并添加额外的判断来实现这一点。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">URL</span> = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>).<span class="property">URL</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;web-contents-created&quot;</span>, <span class="function">(<span class="params">event, contents</span>) =&gt;</span> &#123;</span><br><span class="line">  contents.<span class="title function_">on</span>(<span class="string">&quot;will-navigate&quot;</span>, <span class="function">(<span class="params">event, navigationUrl</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> parsedUrl = <span class="keyword">new</span> <span class="title function_">URL</span>(navigationUrl);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (parsedUrl.<span class="property">origin</span> !== <span class="string">&quot;https://www.zhihu.com/people/uinika/posts&quot;</span>) &#123;</span><br><span class="line">      event.<span class="title function_">preventDefault</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="禁用或限制新窗口创建">禁用或限制新窗口创建</h2>
<p>限制在 Electron
应用程序中创建额外窗口，并避免因此带来额外的安全隐患。<code>webContents</code>创建新窗口时会触发一个<code>web-contents-created</code>事件，该事件包含了将要打开的
URL
以及相关选项，可以在这个事件中检查窗口的创建，从而对其进行相应的限制。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; shell &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;web-contents-created&quot;</span>, <span class="function">(<span class="params">event, contents</span>) =&gt;</span> &#123;</span><br><span class="line">  contents.<span class="title function_">on</span>(<span class="string">&quot;new-window&quot;</span>, <span class="function">(<span class="params">event, navigationUrl</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 通知操作系统在默认浏览器上打开URL</span></span><br><span class="line">    event.<span class="title function_">preventDefault</span>();</span><br><span class="line">    shell.<span class="title function_">openExternal</span>(navigationUrl);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Electron 2.0 版本开始，会在可执行文件名为 Electron
时会为开发者在控制台显示安全相关的警告和建议，开发人员也可以在<code>process.env</code>或<code>window</code>对象上配置<code>ELECTRON_ENABLE_SECURITY_WARNINGS</code>或<code>ELECTRON_DISABLE_SECURITY_WARNINGS</code>手动开启或关闭这些警告。</p>
</blockquote>
<h1 id="应用发布">应用发布</h1>
<p>Electron
的发布有别于传统桌面应用程序编译打包的发部过程，需要首先下载已经<a target="_blank" rel="noopener" href="https://github.com/electron/electron/releases">预编译完成的二进制包</a>，Linux
下二进制包结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">➜  electron-v3.0.7-linux-x64 tree -L 2</span><br><span class="line">.</span><br><span class="line">├── blink_image_resources_200_percent.pak</span><br><span class="line">├── content_resources_200_percent.pak</span><br><span class="line">├── content_shell.pak</span><br><span class="line">├── electron</span><br><span class="line">├── icudtl.dat</span><br><span class="line">├── libffmpeg.so</span><br><span class="line">├── libnode.so</span><br><span class="line">├── LICENSE</span><br><span class="line">├── LICENSES.chromium.html</span><br><span class="line">├── locales</span><br><span class="line">├── natives_blob.bin</span><br><span class="line">├── ui_resources_200_percent.pak</span><br><span class="line">├── v8_context_snapshot.bin</span><br><span class="line">├── version</span><br><span class="line">└── views_resources_200_percent.pak</span><br><span class="line">└── resources</span><br><span class="line">   ├── default_app.asar</span><br><span class="line">   └── electron.asar</span><br></pre></td></tr></table></figure>
<p>接下来，就可以部署前面编写的源代码，Electron
里主要有如下两种部署方式：</p>
<ol type="1">
<li>直接将代码放置到<code>resources</code>下的子目录，比如<code>app</code>目录：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">├── app</span><br><span class="line">│   ├── package.json</span><br><span class="line">│   └── resource</span><br><span class="line">│       ├── index.html</span><br><span class="line">│       └── main.js</span><br><span class="line">├── default_app.asar</span><br><span class="line">└── electron.asar</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>将应用打包加密为<code>asar</code>文件以后放置到<code>resources</code>目录，比如<code>app.asar</code>文件。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">├── app.asar</span><br><span class="line">├── default_app.asar</span><br><span class="line">└── electron.asar</span><br></pre></td></tr></table></figure>
<h1 id="asar-打包源码">asar 打包源码</h1>
<p><a target="_blank" rel="noopener" href="https://github.com/electron/asar">asar</a>
是一种简单的文件扩展格式，可以将文件如同<code>tar</code>格式一样前后连接在一起，支持随机读写，并使用
JSON 来保存文件信息，可以方便的读取与解析。Electron 通过它可以解决
Windows
文件路径长度的限制，提高<code>require</code>语句的加载速度，并且避免源代码泄漏。</p>
<p>首先，需要安装<code>asar</code>这个 npm
包，然后可以选择全局安装然通过命令行使用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  npm install asar</span><br><span class="line">➜  asar pack electron-demo app.asar</span><br></pre></td></tr></table></figure>
<p>当然，更加工程化的方式是通过代码来执行打包操作，就像下面这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> asar = <span class="built_in">require</span>(<span class="string">&quot;asar&quot;</span>);</span><br><span class="line"></span><br><span class="line">src = <span class="string">&quot;../octopus&quot;</span>;</span><br><span class="line">dest = <span class="string">&quot;build/app.asar&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 打包完成后的回调函数 */</span></span><br><span class="line">callback = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;asar打包完成！&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">asar.<span class="title function_">createPackage</span>(src, dest, callback);</span><br></pre></td></tr></table></figure>
<p>Electron 在 Web 页面可以通过<code>file:</code>协议读取 asar
包中的文件，即将 asar 文件视为一个虚拟的文件夹来进行操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>();</span><br><span class="line"></span><br><span class="line">mainWindow.<span class="title function_">loadURL</span>(<span class="string">&quot;file:///path/to/example.asar/static/index.html&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>如果需要对 asar 文件进行 MD5 或者 SHA 完整性校验，可以对 asar
档案文件本身进行操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asar list app.<span class="property">asar</span></span><br></pre></td></tr></table></figure>
<h1 id="rcedit-编辑可执行文件">rcedit 编辑可执行文件</h1>
<p><a target="_blank" rel="noopener" href="http://fvwmrcedit.sourceforge.net/">RcEdit</a>是一款通过编辑窗口管理器的
rc 文件来对其进行配置的工具，Nodejs 社区提供了<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/rcedit">node-rcedit</a>工具对
Windows
操作系统的<code>.exe</code>文件进行配置，首先通过<code>npm i rcedit --save-dev</code>为项目安装该依赖项。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rcedit = <span class="built_in">require</span>(<span class="string">&quot;rcedit&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">rcedit</span>(exePath, options, callback);</span><br></pre></td></tr></table></figure>
<p><code>rcedit()</code>函数包含有如下属性：</p>
<ol type="1">
<li><code>exePath</code>：需要进行修改的 Windows
可执行文件所在路径。</li>
<li><code>options</code>：一个拥有如下属性的配置对象。
<ul>
<li><code>version-string</code>：版本字符串；</li>
<li><code>file-version</code>：文件版本；</li>
<li><code>product-version</code>：产品版本；</li>
<li><code>icon</code>：图标文件<code>.ico</code>的路径;</li>
<li><code>requested-execution-level</code>：需要修改的执行级别（<em><code>asInvoker</code>、<code>highestAvailable</code>、<code>requireAdministrator</code></em>）。</li>
<li><code>application-manifest</code>：本地清单文件的路径。</li>
</ul></li>
<li><code>callback</code>：函数执行完毕之后回调，完整的函数签名为<code>function(error)</code>。</li>
</ol>
<h1 id="yarn-包管理器">yarn 包管理器</h1>
<p>Yarn 是一款由 Facebook 推出的 JavaScript 包管理器，与 NodeJS 提供的
Npm 一样使用<code>package.json</code>作为包信息文件。</p>
<p>测试当前 Yarn 的安装版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn --version</span><br></pre></td></tr></table></figure>
<p>初始化新项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn init</span><br></pre></td></tr></table></figure>
<p>添加依赖包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add [package]</span><br><span class="line">yarn add [package]@[version]</span><br><span class="line">yarn add [package]@[tag]</span><br></pre></td></tr></table></figure>
<p>将依赖项添加到不同的依赖项类别：devDependencies、peerDependencies 和
optionalDependencies。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add [package] --dev</span><br><span class="line">yarn add [package] --peer</span><br><span class="line">yarn add [package] --optional</span><br></pre></td></tr></table></figure>
<p>升级依赖包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn upgrade [package]</span><br><span class="line">yarn upgrade [package]@[version]</span><br><span class="line">yarn upgrade [package]@[tag]</span><br></pre></td></tr></table></figure>
<p>移除依赖包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn remove [package]</span><br></pre></td></tr></table></figure>
<p>可以直接使用<code>yarn</code>命令安装项目的全部依赖：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn install</span><br></pre></td></tr></table></figure>
<h1 id="windows-installer">windows-installer</h1>
<p><a target="_blank" rel="noopener" href="https://github.com/electron/windows-installer">windows-installer</a>是一个用于为
Electron 应用程序构建 Windows 安装程序的 Npn 包，底层基于<a target="_blank" rel="noopener" href="https://github.com/Squirrel/Squirrel.Windows">Squirrel</a>（<em>一组用于管理<strong>C#</strong>或<strong>C++</strong>开发的
Windows 应用程序的安装、更新的工具库</em>）进行实现。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev electron-winstaller</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> electronInstaller = <span class="built_in">require</span>(<span class="string">&quot;electron-winstaller&quot;</span>);</span><br><span class="line"></span><br><span class="line">resultPromise = electronInstaller.<span class="title function_">createWindowsInstaller</span>(&#123;</span><br><span class="line">  <span class="attr">appDirectory</span>: <span class="string">&quot;/tmp/build/my-app-64&quot;</span>,</span><br><span class="line">  <span class="attr">outputDirectory</span>: <span class="string">&quot;/tmp/build/installer64&quot;</span>,</span><br><span class="line">  <span class="attr">authors</span>: <span class="string">&quot;My App Inc.&quot;</span>,</span><br><span class="line">  <span class="attr">exe</span>: <span class="string">&quot;myapp.exe&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">resultPromise.<span class="title function_">then</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;It worked!&quot;</span>),</span><br><span class="line">  <span class="function">(<span class="params">e</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`No dice: <span class="subst">$&#123;e.message&#125;</span>`</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h1 id="electron-build">electron-build</h1>
<p>除了像上面这样通过预编译包手动打包应用程序，也可以采用<a target="_blank" rel="noopener" href="https://github.com/electron-userland/electron-forge">electron-forge</a>、<a target="_blank" rel="noopener" href="https://www.electron.build/">electron-packager</a>等第三方包来完成这项工作，在这里笔者选择<a target="_blank" rel="noopener" href="https://www.electron.build/">electron-builder</a>来进行自动化打包任务。</p>
<p>Electron Userland 是一个维护 Electron
模块的第三方社区，electron-builder 是由其维护的一款能够同时处理
Windows、MacOS、Linux 多平台的打包编译工具。由于 electron-builder
工具包的文件体积较大，其社区强烈推荐使用更快速的<code>yarn</code>来代替<code>npm</code>作为包管理方案。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add electron-builder --dev</span><br></pre></td></tr></table></figure>
<p>electron-builder 能够以<strong>命令行</strong>或者<strong>JavaScript
API</strong>的方式进行使用：</p>
<p>（1）如果安装在项目目录下的<code>node_modules</code>目录，可以直接通过
NodeJS 提供的<code>npx</code>以命令行方式使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx electron-builder</span><br></pre></td></tr></table></figure>
<p>（2）也可以像使用其它 Npm 包那样直接调用 electron-builder 提供的
API。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> builder = <span class="built_in">require</span>(<span class="string">&quot;electron-builder&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Platform</span> = builder.<span class="property">Platform</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise is returned</span></span><br><span class="line">builder</span><br><span class="line">  .<span class="title function_">build</span>(&#123;</span><br><span class="line">    <span class="attr">targets</span>: <span class="title class_">Platform</span>.<span class="property">MAC</span>.<span class="title function_">createTarget</span>(),</span><br><span class="line">    <span class="attr">config</span>: &#123;</span><br><span class="line">      <span class="string">&quot;//&quot;</span>: <span class="string">&quot;build options, see https://goo.gl/QQXmcV&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// handle result</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// handle error</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>官方推荐使用<a target="_blank" rel="noopener" href="https://github.com/electron-userland/electron-webpack-quick-start">electron-webpack-quick-start</a>作为
Electron 应用的项目模板。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// 指定编译配置</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;appId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;your.id&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mac&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;your.app.category.type&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 添加编译指令</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;pack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;electron-builder --dir&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dist&quot;</span><span class="punctuation">:</span> <span class="string">&quot;electron-builder&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 确保原生依赖总是匹配Electron版本</span></span><br><span class="line">  <span class="attr">&quot;postinstall&quot;</span><span class="punctuation">:</span> <span class="string">&quot;electron-builder install-app-deps</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果项目中存在原生依赖，还需要设置<a target="_blank" rel="noopener" href="https://www.electron.build/configuration/configuration#Configuration-nodeGypRebuild">nodeGypRebuild</a>为<code>true</code>。</p>
</blockquote>
<p>如果需要调试<code>electron-builder</code>的行为，那么需要设置<code>DEBUG=electron-builder</code>环境变量。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> DEBUG=electron-builder  // Cmder</span><br><span class="line"><span class="variable">$env</span>:DEBUG=electron-builder  // PowerShell</span><br></pre></td></tr></table></figure>
<h1 id="electron-forge">electron-forge</h1>
<p><a target="_blank" rel="noopener" href="https://electronforge.io/">electron-forge</a>同样是由
Electron Userland 维护的一款命令行工具，用于快速建立、打包、发布一个
Electron 应用程序。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">λ  npm install -g electron-forge</span><br><span class="line">λ  electron-forge init my-new-project</span><br><span class="line">λ  <span class="built_in">cd</span> my-new-project</span><br><span class="line">λ  electron-forge start</span><br></pre></td></tr></table></figure>
<blockquote>
<p>目前 Github 上 electron-builder 的 Star 远远超过
electron-forge，由于笔者项目需要使用 React，因而也就选用带有支持 React
项目模板的 electron-builder，需要尝试 electron-forge
的同学可以移步官网查看更多信息。</p>
</blockquote>
</div><div class="article-licensing box"><div class="licensing-title"><p>使用 Electron 打造跨平台桌面应用</p><p><a href="http://www.uinio.com/Web/Electron/">http://www.uinio.com/Web/Electron/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Hank</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2017-09-22</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2018-01-14</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/JavaScript/">JavaScript</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/Config/Linux/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Linux 工作环境 Config 札记</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/Other/2017-Chengdu-Realestate/"><span class="level-item">2017 年，再聊聊成都房价与地价那些事儿</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#getting-start"><span class="level-left"><span class="level-item">1</span><span class="level-item">Getting Start</span></span></a></li><li><a class="level is-mobile" href="#主进程与渲染进程"><span class="level-left"><span class="level-item">2</span><span class="level-item">主进程与渲染进程</span></span></a></li><li><a class="level is-mobile" href="#核心模块"><span class="level-left"><span class="level-item">3</span><span class="level-item">核心模块</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#app-模块"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">app 模块</span></span></a></li><li><a class="level is-mobile" href="#browserwindow-模块"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">BrowserWindow 模块</span></span></a></li><li><a class="level is-mobile" href="#globalshortcut-模块"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">globalShortcut 模块</span></span></a></li><li><a class="level is-mobile" href="#clipboard-模块"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">clipboard 模块</span></span></a></li><li><a class="level is-mobile" href="#globalshortcut-模块-1"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">globalShortcut 模块</span></span></a></li><li><a class="level is-mobile" href="#ipcmain-与-ipcrenderer-模块"><span class="level-left"><span class="level-item">3.6</span><span class="level-item">ipcMain 与 ipcRenderer 模块</span></span></a></li><li><a class="level is-mobile" href="#menu-与-menuitem-模块"><span class="level-left"><span class="level-item">3.7</span><span class="level-item">Menu 与 MenuItem 模块</span></span></a></li><li><a class="level is-mobile" href="#netlog-模块"><span class="level-left"><span class="level-item">3.8</span><span class="level-item">netLog 模块</span></span></a></li><li><a class="level is-mobile" href="#powermonitor-模块"><span class="level-left"><span class="level-item">3.9</span><span class="level-item">powerMonitor 模块</span></span></a></li><li><a class="level is-mobile" href="#powersaveblocker-模块"><span class="level-left"><span class="level-item">3.10</span><span class="level-item">powerSaveBlocker 模块</span></span></a></li><li><a class="level is-mobile" href="#protocol-模块"><span class="level-left"><span class="level-item">3.11</span><span class="level-item">protocol 模块</span></span></a></li><li><a class="level is-mobile" href="#net-模块"><span class="level-left"><span class="level-item">3.12</span><span class="level-item">net 模块</span></span></a></li><li><a class="level is-mobile" href="#remote-模块"><span class="level-left"><span class="level-item">3.13</span><span class="level-item">remote 模块</span></span></a></li><li><a class="level is-mobile" href="#screen-模块"><span class="level-left"><span class="level-item">3.14</span><span class="level-item">screen 模块</span></span></a></li><li><a class="level is-mobile" href="#shell-模块"><span class="level-left"><span class="level-item">3.15</span><span class="level-item">shell 模块</span></span></a></li><li><a class="level is-mobile" href="#systempreferences-模块"><span class="level-left"><span class="level-item">3.16</span><span class="level-item">systemPreferences 模块</span></span></a></li><li><a class="level is-mobile" href="#tray-模块"><span class="level-left"><span class="level-item">3.17</span><span class="level-item">Tray 模块</span></span></a></li><li><a class="level is-mobile" href="#webframe-模块"><span class="level-left"><span class="level-item">3.18</span><span class="level-item">webFrame 模块</span></span></a></li><li><a class="level is-mobile" href="#session-模块"><span class="level-left"><span class="level-item">3.19</span><span class="level-item">session 模块</span></span></a></li><li><a class="level is-mobile" href="#desktopcapturer-模块"><span class="level-left"><span class="level-item">3.20</span><span class="level-item">desktopCapturer 模块</span></span></a></li><li><a class="level is-mobile" href="#dialog-模块"><span class="level-left"><span class="level-item">3.21</span><span class="level-item">dialog 模块</span></span></a></li><li><a class="level is-mobile" href="#contenttracing-模块"><span class="level-left"><span class="level-item">3.22</span><span class="level-item">contentTracing 模块</span></span></a></li></ul></li><li><a class="level is-mobile" href="#webview-标签"><span class="level-left"><span class="level-item">4</span><span class="level-item">webview 标签</span></span></a></li><li><a class="level is-mobile" href="#webcontents-属性"><span class="level-left"><span class="level-item">5</span><span class="level-item">webContents 属性</span></span></a></li><li><a class="level is-mobile" href="#window.open-函数"><span class="level-left"><span class="level-item">6</span><span class="level-item">window.open() 函数</span></span></a></li><li><a class="level is-mobile" href="#electron-进程"><span class="level-left"><span class="level-item">7</span><span class="level-item">Electron 进程</span></span></a></li><li><a class="level is-mobile" href="#沙箱机制"><span class="level-left"><span class="level-item">8</span><span class="level-item">沙箱机制</span></span></a></li><li><a class="level is-mobile" href="#macbook-touchbar-支持"><span class="level-left"><span class="level-item">9</span><span class="level-item">MacBook TouchBar 支持</span></span></a></li><li><a class="level is-mobile" href="#创建应用图标"><span class="level-left"><span class="level-item">10</span><span class="level-item">创建应用图标</span></span></a></li><li><a class="level is-mobile" href="#安全原则"><span class="level-left"><span class="level-item">11</span><span class="level-item">安全原则</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#使用安全的协议加载外部内容"><span class="level-left"><span class="level-item">11.1</span><span class="level-item">使用安全的协议加载外部内容</span></span></a></li><li><a class="level is-mobile" href="#加载外部内容时禁用-nodejs-集成"><span class="level-left"><span class="level-item">11.2</span><span class="level-item">加载外部内容时禁用 NodeJS
集成</span></span></a></li><li><a class="level is-mobile" href="#渲染进程中启用上下文隔离"><span class="level-left"><span class="level-item">11.3</span><span class="level-item">渲染进程中启用上下文隔离</span></span></a></li><li><a class="level is-mobile" href="#处理远程内容中的会话许可"><span class="level-left"><span class="level-item">11.4</span><span class="level-item">处理远程内容中的会话许可</span></span></a></li><li><a class="level is-mobile" href="#不要禁用-websecurity"><span class="level-left"><span class="level-item">11.5</span><span class="level-item">不要禁用 webSecurity</span></span></a></li><li><a class="level is-mobile" href="#定义-csp-安全策略"><span class="level-left"><span class="level-item">11.6</span><span class="level-item">定义 CSP 安全策略</span></span></a></li><li><a class="level is-mobile" href="#别设置-allowrunninginsecurecontent-为-true"><span class="level-left"><span class="level-item">11.7</span><span class="level-item">别设置
allowRunningInsecureContent 为 true</span></span></a></li><li><a class="level is-mobile" href="#不要开启实验性功能"><span class="level-left"><span class="level-item">11.8</span><span class="level-item">不要开启实验性功能</span></span></a></li><li><a class="level is-mobile" href="#不要使用-enableblinkfeatures"><span class="level-left"><span class="level-item">11.9</span><span class="level-item">不要使用 enableBlinkFeatures</span></span></a></li><li><a class="level is-mobile" href="#禁用-webview-的-allowpopups"><span class="level-left"><span class="level-item">11.10</span><span class="level-item">禁用 webview 的 allowpopups</span></span></a></li><li><a class="level is-mobile" href="#验证-webview-选项与参数"><span class="level-left"><span class="level-item">11.11</span><span class="level-item">验证 webview 选项与参数</span></span></a></li><li><a class="level is-mobile" href="#禁用或限制网页跳转"><span class="level-left"><span class="level-item">11.12</span><span class="level-item">禁用或限制网页跳转</span></span></a></li><li><a class="level is-mobile" href="#禁用或限制新窗口创建"><span class="level-left"><span class="level-item">11.13</span><span class="level-item">禁用或限制新窗口创建</span></span></a></li></ul></li><li><a class="level is-mobile" href="#应用发布"><span class="level-left"><span class="level-item">12</span><span class="level-item">应用发布</span></span></a></li><li><a class="level is-mobile" href="#asar-打包源码"><span class="level-left"><span class="level-item">13</span><span class="level-item">asar 打包源码</span></span></a></li><li><a class="level is-mobile" href="#rcedit-编辑可执行文件"><span class="level-left"><span class="level-item">14</span><span class="level-item">rcedit 编辑可执行文件</span></span></a></li><li><a class="level is-mobile" href="#yarn-包管理器"><span class="level-left"><span class="level-item">15</span><span class="level-item">yarn 包管理器</span></span></a></li><li><a class="level is-mobile" href="#windows-installer"><span class="level-left"><span class="level-item">16</span><span class="level-item">windows-installer</span></span></a></li><li><a class="level is-mobile" href="#electron-build"><span class="level-left"><span class="level-item">17</span><span class="level-item">electron-build</span></span></a></li><li><a class="level is-mobile" href="#electron-forge"><span class="level-left"><span class="level-item">18</span><span class="level-item">electron-forge</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/C-C-%E8%AF%AD%E8%A8%80/"><span class="level-start"><span class="level-item">C/C++ 语言</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"><span class="level-start"><span class="level-item">Linux 操作系统</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/Python-%E8%AF%AD%E8%A8%80/"><span class="level-start"><span class="level-item">Python 语言</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/UINIO-%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E8%B5%84%E6%96%99/"><span class="level-start"><span class="level-item">UINIO 开源项目资料</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Web-%E5%BC%80%E5%8F%91/"><span class="level-start"><span class="level-item">Web 开发</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/%E4%BA%A7%E4%B8%9A%E7%BB%8F%E6%B5%8E/"><span class="level-start"><span class="level-item">产业经济</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%A4%96%E8%A7%82%E4%B8%8E%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/"><span class="level-start"><span class="level-item">外观与结构设计</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%9B%BA%E4%BB%B6/"><span class="level-start"><span class="level-item">嵌入式固件</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"><span class="level-start"><span class="level-item">开发环境配置</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E5%AD%A6/"><span class="level-start"><span class="level-item">数学</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86/"><span class="level-start"><span class="level-item">版本管理</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8/"><span class="level-start"><span class="level-item">生活日常</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%A1%AC%E4%BB%B6%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">硬件电子技术</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%AE%97%E6%B3%95/"><span class="level-start"><span class="level-item">算法</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%8B%B1%E8%AF%AD/"><span class="level-start"><span class="level-item">英语</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">软件工具</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><figure class="media-left"><a class="image" href="/Electronics/TVS/"><img src="/Electronics/TVS/logo.png" alt="瞬态电压抑制二极管 TVS 选型简述"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-09-05T16:00:00.000Z">2024-09-06</time></p><p class="title"><a href="/Electronics/TVS/">瞬态电压抑制二极管 TVS 选型简述</a></p><p class="categories"><a href="/categories/%E7%A1%AC%E4%BB%B6%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/">硬件电子技术</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/Electronics/Battery/"><img src="/Electronics/Battery/logo.png" alt="锂离子电池技术参数简明选型指南"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-08-28T16:00:00.000Z">2024-08-29</time></p><p class="title"><a href="/Electronics/Battery/">锂离子电池技术参数简明选型指南</a></p><p class="categories"><a href="/categories/%E7%A1%AC%E4%BB%B6%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/">硬件电子技术</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/Electronics/LTspice/"><img src="/Electronics/LTspice/logo.png" alt="如何使用新版本的 LTspice 进行模拟电路仿真"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-05-21T16:00:00.000Z">2024-05-22</time></p><p class="title"><a href="/Electronics/LTspice/">如何使用新版本的 LTspice 进行模拟电路仿真</a></p><p class="categories"><a href="/categories/%E7%A1%AC%E4%BB%B6%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/">硬件电子技术</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/Electronics/SI9000/"><img src="/Electronics/SI9000/logo.png" alt="基于 Polar Si9000e 计算传输线特征阻抗的全攻略"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-04-04T16:00:00.000Z">2024-04-05</time></p><p class="title"><a href="/Electronics/SI9000/">基于 Polar Si9000e 计算传输线特征阻抗的全攻略</a></p><p class="categories"><a href="/categories/%E7%A1%AC%E4%BB%B6%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/">硬件电子技术</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/Electronics/Component/"><img src="/Electronics/Component/logo.png" alt="硬件电路设计当中 の 常用分立元器件选型"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-03-30T16:00:00.000Z">2024-03-31</time></p><p class="title"><a href="/Electronics/Component/">硬件电路设计当中 の 常用分立元器件选型</a></p><p class="categories"><a href="/categories/%E7%A1%AC%E4%BB%B6%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/">硬件电子技术</a></p></div></article></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Arduino/"><span class="tag">Arduino</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CAD/"><span class="tag">CAD</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CSS/"><span class="tag">CSS</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/EDA/"><span class="tag">EDA</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GCC-GDB/"><span class="tag">GCC/GDB</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HTML/"><span class="tag">HTML</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LaTeX/"><span class="tag">LaTeX</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MCU/"><span class="tag">MCU</span><span class="tag">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Make/"><span class="tag">Make</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Markdown/"><span class="tag">Markdown</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PCB/"><span class="tag">PCB</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python3/"><span class="tag">Python3</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Qt/"><span class="tag">Qt</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Shell/"><span class="tag">Shell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Solidity/"><span class="tag">Solidity</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tools/"><span class="tag">Tools</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows/"><span class="tag">Windows</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BB%A3%E6%95%B0/"><span class="tag">代数</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BB%BF%E7%9C%9F/"><span class="tag">仿真</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%85%83%E5%99%A8%E4%BB%B6/"><span class="tag">元器件</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/"><span class="tag">命令行</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"><span class="tag">密码学</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B0%84%E9%A2%91/"><span class="tag">射频</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F-Linux/"><span class="tag">嵌入式 Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/"><span class="tag">开发规范</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%BE%AE%E7%A7%AF%E5%88%86/"><span class="tag">微积分</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%89%8B%E6%9C%BA/"><span class="tag">手机</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E5%AD%A6%E7%BB%93%E6%9E%84/"><span class="tag">数学结构</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%B0%E6%A6%82%E5%BF%B5%E8%8B%B1%E8%AF%AD/"><span class="tag">新概念英语</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/"><span class="tag">服务器</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9D%82%E8%B0%88/"><span class="tag">杂谈</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B1%BD%E8%BD%A6/"><span class="tag">汽车</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%B5%E5%AD%90%E4%BB%AA%E5%99%A8/"><span class="tag">电子仪器</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%B5%E6%BA%90/"><span class="tag">电源</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%B5%E8%B7%AF%E7%90%86%E8%AE%BA/"><span class="tag">电路理论</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/"><span class="tag">网络协议</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="tag">设计模式</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AF%AD%E6%B3%95/"><span class="tag">语法</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><p class="is-size-7"><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><img src="/images/ICP.png"> 蜀 ICP 备 2021027760 号</a><p class="is-size-7">Copyright © 2024 <span>UinIO.com</span> by Hank</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://unpkg.com/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://unpkg.com/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://unpkg.com/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://unpkg.com/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://unpkg.com/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><script src="/js/math.js"></script><script id="MathJax-script" async src="/js/es5/tex-mml-chtml.js"></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>